/*
 * excelcsv
 *
 * Copyright (c) 2014 Jason Pescione
 * Licensed under the MIT license.
 *
 * @file Mocha tests for ExcelCSV.
 *
 */

'use strict';

/*jshint expr: true*/

var ExcelCSV = require('../lib/excelcsv.js')
  , fs       = require('fs');

describe('ExcelCSV E2E testing', function(){

  var excelcsv
    , options
    , header
    , cwd = process.cwd();

  beforeEach(function() {
    header  = ['id', 'email', 'address', 'city', 'state', 'zip'];
  });

  describe('when parsing ".xlsx" files', function () {

    beforeEach(function() {
      excelcsv = new ExcelCSV( cwd + '/test/fixtures/example.xlsx', cwd + '/tmp/example-xlsx.csv' );
    });

    afterEach(function(){
      excelcsv = null;
    });

    it('should produce a file that matches the expected output', function() {

      excelcsv
        .header( header )
        .row(function(row, worksheetName) {
          return row;
        })
        .init();

      var expected = excelcsv.readFileSync( cwd + '/test/expected/example.csv', 'utf8' );
      var actual   = excelcsv.readFileSync( cwd + '/tmp/example-xlsx.csv', 'utf8' );
      expected.should.equal( actual );
    });

    it('should skip rows when the ".row()" method returns false.', function() {

      excelcsv
        .row(function(row, worksheetName) {
          return false;
        })
        .init();

        var actual = excelcsv.readFileSync( cwd + '/tmp/example-xlsx.csv', 'utf8' );
        actual.should.equal("");
    });

  });


});
